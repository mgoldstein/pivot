<?php
/**
 * @file
 * A module defining custom functionality for the Pivot.tv website
 *
 */
/**
 * Implements hook_help();
 */
function pivot_global_help($path, $arg) {
    if ($path == 'admin/help#pivot_global') {
        return t('A module defining custom functionality for the Pivot.tv website');
    }
}
/**
 * Define custom blocks for the Pivot.tv site
 */
include 'pivot_global.blocks.inc';


/**
 * Implements hook_menu();
 */
function pivot_global_menu() {
  $items['iframe/header'] = array(
    'page callback' => 'pivot_global_iframe_header',
    'access arguments' => array('access content'),
  );
  $items['iframe/footer'] = array(
    'page callback' => 'pivot_global_iframe_footer',
    'access arguments' => array('access content'),
  );
  return $items;
}


/**
* Implements hook_entity_info_alter().
*/
function pivot_global_entity_info_alter(&$entity_info) {
  $entity_info['node']['view modes']['promo'] = array(
    'label' => t('Square Promo'),
    'custom settings' => TRUE,
  );
  $entity_info['node']['view modes']['promo_alt'] = array(
    'label' => t('16x9 Promo'),
    'custom settings' => TRUE,
  );
}

/**
* Prevent Drupal from checking for updates on custom created modules
**/
function pivot_global_update_projects_alter(&$projects) {
  unset($projects['pivot_global']);
  unset($projects['pivot_campaign']);
  unset($projects['pivot_hero']);
  unset($projects['pivot_dml']);
}
/**
* Implements hook_preprocess_node().
*/
function pivot_global_preprocess_node(&$variables) {
  if($variables['view_mode'] == 'promo') {
    // add classes to promo <article>s
    $variables['classes_array'][] = 'promo';
    $variables['classes_array'][] = 'node-' . $variables['type'] . '-promo';

    // use our custom templates for easy overridability
    $variables['theme_hook_suggestions'][] = 'node__promo';
    $variables['theme_hook_suggestions'][] = 'node__' . $variables['type'] . '__promo';

    // write an external link tag if any
    $variables['promo_external_anchor_tag'] = '';
    if ($variables['field_external_link'] && $variables['field_external_link']['und'][0]['url']) {
      $variables['promo_external_anchor_tag'] .= '<a href="' . $variables['field_external_link']['und'][0]['url'] . '"';
      if (isset($variables['field_external_link']['und'][0]['title'])) {
	$variables['promo_external_anchor_tag'] .= ' title="' . $variables['field_external_link']['und'][0]['title'] .'"';
      }
      if (isset($variables['field_external_link']['und'][0]['attributes']['target'])) {
	$variables['promo_external_anchor_tag'] .= ' target="' . $variables['field_external_link']['und'][0]['attributes']['target'] . '"';
      }
      $variables['promo_external_anchor_tag'] .= '>';
    }
  } else if ($variables['view_mode'] == "promo_alt") {
    // add classes to promo <article>s
    $variables['classes_array'][] = 'promo-alt';
    $variables['classes_array'][] = 'node-' . $variables['type'] . '-promo-alt';

    // use our custom templates for easy overridability
    $variables['theme_hook_suggestions'][] = 'node__promo_alt';
    $variables['theme_hook_suggestions'][] = 'node__' . $variables['type'] . '__promo_alt';
  } else if ($variables['view_mode'] == 'teaser') {
    $variables['theme_hook_suggestions'][] = 'node__' . $variables['type'] . '__teaser';
  }
}

function pivot_global_iframe_header(){
  $output = 'something';
  return $output;
}
function pivot_global_iframe_footer(){
  $output = 'something';
  return $output;
}

